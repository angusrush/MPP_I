\documentclass[main.tex]{subfiles}

\begin{document}

\section{Cocartesian fibrations between complete Segal spaces}
\label{sec:cocartesian_fibrations_between_complete_segal_spaces}

\subsection{Marked bisimplicial sets}
\label{ssc:marked_bisimplicial_sets}

\begin{definition}
  A \defn{marked bisimplicial set} $(X, \mathcal{E})$ is a bisimplicial set $X$ together with a distinguished subset $\mathcal{E} \subseteq (X_{1})_{0}$ containing all degenerate edges, i.e.\ all edges in the image of $s_{0}\colon (X_{0})_{0} \to (X_{1})_{0}$. Equivalently, a marked bisimplicial set is bisimplicial set $X$ together with a marking $\mathcal{E}$ on the simplicial set $i^{*}_{1}X$.
\end{definition}

The category of marked bisimplicial sets is finitely complete and cocomplete.

\begin{definition}
  For a marked simplicial set $A$ and an unmarked simplicial set $B$, define a marking on the bisimplicial set $A \square B$ as follows: a simplex $(a, b) \in A_{1} \times B_{0}$ is marked if and only if $a$ is marked.
\end{definition}

\begin{note}
  Toby: At the moment, I am not notationally distinguishing between the marked and unmarked versions of the $\square$ and $-/-$ constructions. (The unmarked versions are from \cite{qcats_vs_segal_spaces}.) This requires that readers keep track for themselves when a (bi)simplicial set is or isn't marked. If you think this is confusing, I'll try and come up with some other notation.
\end{note}

For any marked simplicial set $A$, denote the underlying unmarked simplicial set by $\mathring{A}$. Similarly, for any marked bisimplicial set $X$, denote the underlying unmarked bisimplicial set by $\mathring{X}$.

\begin{definition}
  Let $A$ denote a marked simplicial set, $B$ an unmarked simplicial set, and $X$ a marked bisimplicial set.
  \begin{itemize}
    \item Define an unmarked simplicial set $A \backslash X$ level-wise by
      \begin{equation*}
        (A \backslash X)_{n} = \Hom_{\SSSet^{+}}(A \square \Delta^{n}, X).
      \end{equation*}

    \item Define a marked simplicial set $X / B$ as follows. The underlying simplicial set is the same as $\mathring{X} / \mathring{B}$, and a 1-simplex $\Delta^{1} \to X / B$ is marked if and only if the corresponding map $\Delta^{1} \square B \to X$ of unmarked bisimplicial sets comes from a map of marked bisimplicial sets $(\Delta^{1})^{\sharp} \square B \to X$.
  \end{itemize}
\end{definition}

\begin{proposition}
  We have the following adjunctions.

  \begin{enumerate}
    \item For each marked simplicial set $A \in \SSet^{+}$ there is an adjunction.
      \begin{equation*}
        A \square -\colon \SSet \leftrightarrow \SSSet^{+} : A \backslash -
      \end{equation*}

    \item For each unmarked simplicial set $B \in \SSet$ there is an adjunction.
      \begin{equation*}
        - \square B\colon \SSet^{+} \leftrightarrow \SSSet : - / B.
      \end{equation*}
  \end{enumerate}
\end{proposition}
\begin{proof}
  In the first case, we know that the bijection
  \begin{equation*}
    \Hom_{\SSSet^{+}}(A \square \Delta^{n}, X) \cong \Hom_{\SSet}(\Delta^{n}, A \backslash X)
  \end{equation*}
  holds for each $n$, and both sides preserve colimits.

  In the second case, we
\end{proof}

This shows that the marked version of $\square$ is, in the language of \cite{qcats_vs_segal_spaces}, \emph{divisible on the left and on the right.} This implies that $A \backslash X$ is a functor of both $A$ and $X$, and that $X / B$ is a functor of both $X$ and $B$. This in turn implies that there is a bijection between maps
\begin{equation*}
  A \square B \to X,\qquad A \to X / B \qquad \text{and}\quad B \to A \backslash X.
\end{equation*}
Thus, the functors $- \backslash X$ and $X / -$ are mutually right adjoint. Since $\SSet$, $\SSet^{+}$, and $\SSSet^{+}$ are all finitely complete and cocomplete, the results of \cite[Sec.\ 7]{qcats_vs_segal_spaces} imply that we get functors

\begin{note}
  Toby: This would go on for a while. I'll probably reproduce the relevant parts of \cite{qcats_vs_segal_spaces} in a separate section, and then reference stuff there.
\end{note}

%Let $\category{C}$ be an $\infty$-category, and let $\Gamma(\category{C})$ be the complete Segal space
%\begin{equation*}
%  \Gamma(\category{C})_{n} \cong \Map(\Delta^{n}, \category{C})^{\simeq}.
%\end{equation*}
%Clearly, a marking on $\category{C}$ gives a marking on $\Gamma(\category{C})$.
%
%\begin{lemma}
%  Let $\category{C}$ be a quasicategory with a marking, and let $A$ be a marked simplicial set. There is an isomorphism of simplicial sets
%  \begin{equation*}
%    A \backslash \Gamma(\category{C}) \cong \Map^{+}(A, \category{C})^{\simeq},
%  \end{equation*}
%  where $\Map^{+}$ denotes the full subcategory of maps of marked simplicial sets. This isomorphism is natural in $A$. Furthermore, if the marking on $\category{C}$ contains all equivalences and is closed under composition, then the inclusion
%  \begin{equation*}
%    A \backslash \Gamma(\category{C}) \cong \Map^{+}(A, \category{C})^{\simeq} \subseteq \Map(A, \category{C})^{\simeq} \cong A^{\flat}  \backslash \Gamma(\category{C})
%  \end{equation*}
%  is a full subcategory inclusion of connected components.
%\end{lemma}

\begin{note}
  Toby: Is `full subcategory inclusion' the right terminology for the below? I mean that an $n$-simplex of $A^{\flat} \backslash X$ belongs to in $A \backslash X$ if and only if each of its vertices belong to $A^{\flat}$.
\end{note}

\begin{lemma}
  For any marked simplicial set $A$ and marked bisimplicial set $X$, the simplicial set $A \backslash X$ is a Kan complex, and the inclusion $i\colon A \backslash X \hookrightarrow A^{\flat} \backslash X \cong \mathring{A} \backslash \mathring{X}$ is a full subcategory inclusion.
\end{lemma}
\begin{proof}
  We first show that the map $i$ is a full subcategory inclusion. The $n$-simplices of $A \backslash X$ are maps of marked simplicial sets $\tilde{\sigma}\colon A \square \Delta^{n} \to X$. A map of underlying bisimplicial sets gives a map of marked bisimplicial sets if and only if it respects the markings, i.e.\ if and only if for each $(a, i) \in A_{1} \times (\Delta^{n})_{0}$ with $a$ marked, $\tilde{\sigma}(a, i)$ is marked in $X$. This is equivalent to demanding that $\sigma|_{\Delta^{\{i\}}}$ belong to $A \backslash X$.

  To show that $A \backslash X$ is a Kan complex, we need to find dashed lifts below.
  \begin{equation*}
    \begin{tikzcd}
      \Lambda^{n}_{k}
      \arrow[r]
      \arrow[d, hook]
      & A \backslash X
      \\
      \Delta^{n}
      \arrow[ur, dashed]
    \end{tikzcd}.
  \end{equation*}
  For $n = 1$, the horn inclusion is of the form $\Delta^{0} \hookrightarrow \Delta^{1}$, and we can take the lift to be degenerate. For $n \geq 2$, we can augment our diagram as follows.
  \begin{equation*}
    \begin{tikzcd}
      \Lambda^{n}_{k}
      \arrow[r]
      \arrow[d, hook]
      & A \backslash X
      \arrow[r]
      & A^{\flat} \backslash X
      \\
      \Delta^{n}
      \arrow[urr, dashed]
    \end{tikzcd}.
  \end{equation*}
  Since $A^{\flat} \backslash X$ is a Kan complex, we can always find such a dashed lift. The inclusion $\Lambda^{n}_{k} \hookrightarrow \Delta^{n}$ is full on vertices, so our lift factors through $A \backslash X$.
\end{proof}

\begin{definition}
  Let $X$ be a bisimplicial set, and let $\mathcal{E}$ be a marking on $X$. We will say that $\mathcal{E}$ \defn{respects path components} if it has the following property: for any map $\Delta^{1} \to X_{1}$ representing an edge $e \to e'$ between morphisms $e$ and $e'$, the morphism $e$ is marked if and only if the morphism $e'$ is marked.
\end{definition}

\begin{proposition}
  \label{prop:cartesian_marking_respects_path_components}
  Let $f\colon X \to Y$ be a Reedy fibration between marked bisimplicial sets such that the marking on $X$ respects path components, and let $u\colon A \to A'$ be a morphism of marked simplicial sets whose underlying morphism of unmarked simplicial spaces is a monomorphism. Then the map $\langle u \backslash f \rangle$ is a Kan fibration.
\end{proposition}
\begin{proof}
  We need to show that for each $n \geq 0$ and $0 \leq k \leq n$ we can solve the lifting problem
  \begin{equation*}
    \begin{tikzcd}
      \Lambda^{n}_{k}
      \arrow[r]
      \arrow[d]
      & A' \backslash X
      \arrow[d]
      \\
      \Delta^{n}
      \arrow[r]
      \arrow[ur, dashed]
      & A \backslash X \times_{A' \backslash Y} A' \backslash X
    \end{tikzcd}.
  \end{equation*}
  First assume that $n \geq 2$. We can augment the above square as follows.
  \begin{equation*}
    \begin{tikzcd}
      \Lambda^{n}_{k}
      \arrow[r]
      \arrow[d]
      & A' \backslash X
      \arrow[r]
      \arrow[d]
      & A^{\flat} \backslash X
      \arrow[d]
      \\
      \Delta^{n}
      \arrow[r]
      & A \backslash X \times_{A' \backslash Y} A' \backslash X
      \arrow[r]
      & A^{\flat} \backslash X \times_{(A')^{\flat} \backslash Y} (A')^{\flat} \backslash X
    \end{tikzcd}.
  \end{equation*}
  Since the map on the right is a Kan fibration, we can solve the outer lifting problem. All the vertices of $\Delta^{n}$ belong to $\Lambda^{n}_{k}$, so a lift of the outside square factors through $A' \backslash X$.

  Now take $n = 1$, $k = 0$, so our horn inclusion is $\Delta^{\{0\}} \hookrightarrow \Delta^{1}$. We need to be able to solve the lifting problem
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r]
      \arrow[d]
      & X / \Delta^{1}
      \arrow[d]
      \\
      A'
      \arrow[r]
      \arrow[ur, dashed]
      & X / \Delta^{0} \times_{Y / \Delta^{0}} Y / \Delta^{1}
    \end{tikzcd}.
  \end{equation*}
  Note that a lift always exists on the level of simplicial sets, so we only need to check that any such lift respects the marking on $X$. To see this, consider the following triangle formed by some dashed lift.
  \begin{equation*}
    \begin{tikzcd}[row sep=small, column sep=large]
      & X / \Delta^{1}
      \arrow[dd]
      \\
      A'
      \arrow[ur, dashed]
      \arrow[dr]
      \\
      & X / \Delta^{0}
    \end{tikzcd}
  \end{equation*}
  Let $a \in A_{1}$ be a marked 1-simplex, and consider the diagram
  \begin{equation*}
    \begin{tikzcd}[row sep=small, column sep=large]
      \Delta^{1} \square \Delta^{0}
      \arrow[r, "{(a, \id)}"]
      \arrow[dd]
      & A \square \Delta^{0}
      \arrow[dd]
      \arrow[dr]
      \\
      && X
      \\
      \Delta^{1} \square \Delta^{1}
      \arrow[r, "{(a, \id)}"]
      & A \square \Delta^{1}
      \arrow[ur, dashed, swap, "\ell"]
    \end{tikzcd},
  \end{equation*}
  where the triangle on the right is the adjunct to the triangle above. In order to check that the dashed lift respects the marking on $X$, we have to show that for each $(a, b) \in (A \square \Delta^{1})_{10} = A_{1} \times \{0, 1\}$, the morphism $\ell(a, b)$ is marked in $X$. The commutativity of the triangle guarantees this for $b = 0$. The map $\Delta^{1} \square \Delta^{1} \to X$ gives us a 1-simplex in $X_{1}$ connecting $\ell(a, 0)$ and $\ell(a, 1)$, which implies by that $\ell(a, 1)$ is also marked because each marking respects path components.

  The case $n = 1$, $k = 1$ is essentially identical.
\end{proof}

\subsection{Cocartesian morphisms}
\label{ssc:cocartesian_morphisms}

\begin{definition}
  Let $f\colon X \to Y$ be a Reedy fibration between complete Segal spaces. A morphism $e \in X_{10}$ is \defn{$f$-cocartesian} if the square
  \begin{equation*}
    \begin{tikzcd}
      \Delta^{2} \backslash X \times_{\Delta^{\{0, 1\}} \backslash X} \{e\}
      \arrow[r]
      \arrow[d]
      & \Lambda^{2}_{0} \backslash X \times_{\Delta^{\{0, 1\}} \backslash X} \{e\}
      \arrow[d]
      \\
      \Delta^{2} \backslash Y \times_{\Delta^{\{0, 1\}} \backslash Y} \{fe\}
      \arrow[r]
      & \Lambda^{2}_{0} \backslash Y \times_{\Delta^{\{0, 1\}} \backslash Y} \{fe\}
    \end{tikzcd}
  \end{equation*}
  is homotopy pullback.
\end{definition}

\begin{example}
  Identity morphisms are clearly $f$-cocartesian.
\end{example}

\begin{definition}
  For $n \geq 1$, define the following simplicial subsets of $\Delta^{n}$.

  \begin{itemize}
    \item For $n \geq 1$, denote by $I_{n}$ the \defn{spine} of $\Delta^{n}$, i.e.\ the simplicial subset
      \begin{equation*}
        \Delta^{\{0, 1\}} \amalg_{\Delta^{\{1\}}} \Delta^{\{1, 2\}} \amalg_{\Delta^{\{2\}}} \cdots \amalg_{\Delta^{\{n-1\}}} \Delta^{\{n-1, n\}} \subseteq \Delta^{n}.
      \end{equation*}

    \item For $n \geq 2$, denote by $L_{n}$ the simplicial subset
      \begin{equation*}
        L_{n} = \Delta^{\{0, 1\}} \amalg_{\Delta^{\{0\}}} \Delta^{\{0, 2\}} \amalg_{\Delta^{\{2\}}} \overbrace{\Delta^{\{2, 3\}} \amalg_{\Delta^{\{3\}}}\cdots \amalg_{\Delta^{\{n-1\}}} \Delta^{\{n-1, n\}}}^{I_{\{2, \ldots, n\}}} \subseteq \Delta^{n}.
      \end{equation*}
      That is, $L_{n}$ is the union of $\Delta^{\{0, 1\}}$ with the spine of $d_{1}\Delta^{n}$. We will call $L_{n}$ the \defn{left spine} of $\Delta^{n}$.
  \end{itemize}
\end{definition}

Note that $L_{2} \cong \Lambda^{2}_{0}$.

%\begin{lemma}
%  For any $n \geq 2$, the map
%  \begin{equation*}
%    \Delta^{\{0, \ldots, n-1\}} \amalg_{\Delta^{\{n-1\}}} \Delta^{\{n-1, n\}} \hookrightarrow \Delta^{n}
%  \end{equation*}
%  is inner anodyne.
%\end{lemma}
%\begin{proof}
%  This map can be written as the starred smash product of $\emptyset \hookrightarrow \Delta^{n-2}$, which is an inclusion, and $\Delta^{\{0\}} \hookrightarrow \Delta^{1}$, which is left anodyne. The result follows from \cite[Lemma 2.1.2.3]{highertopostheory}.
%\end{proof}

\begin{note}
  Toby: I don't know if the below proof is easy enough that it doesn't need to be expanded. I started typing out a more detailed proof, but the the notation became pretty terrible. This should probably be taken as another sign that better notation is needed.
\end{note}

\begin{proposition}
  \label{prop:only_lowest_lifting_condition_is_necessary}
  Let $f\colon X \to Y$ be a Reedy fibration between Segal spaces, and let $e \in X_{10}$ be an $f$-cocartesian morphism. Then the square
  \begin{equation*}
    \begin{tikzcd}
      \Delta^{n} \backslash X \times_{\Delta^{\{0, 1\}} \backslash X} \{e\}
      \arrow[r]
      \arrow[d]
      & L_{n} \backslash X \times_{\Delta^{\{0, 1\}} \backslash X} \{e\}
      \arrow[d]
      \\
      \Delta^{n} \backslash Y \times_{\Delta^{\{0, 1\}} \backslash Y} \{fe\}
      \arrow[r]
      & L_{n} \backslash Y \times_{\Delta^{\{0, 1\}} \backslash Y} \{fe\}
    \end{tikzcd}
  \end{equation*}
  is homotopy pullback for all $n \geq 2$.
\end{proposition}
\begin{proof}
  We have the base case $n = 2$ because $e$ is $f$-cocartesian. The higher cases follow from the Segal condition.

  % Assume the result is true for $n - 1$. Then the square
  % \begin{equation*}
  %   \begin{tikzcd}
  %     (\Delta^{n-1} \backslash X \times_{\Delta^{\{0, 1\}} \backslash X} \{e\}) \times_{\Delta^{\{n-1\}} \backslash X} \Delta^{\{n-1, n\}} \backslash X
  %     \arrow[r]
  %     \arrow[d]
  %     & L_{n} \backslash X \times_{\Delta^{\{0, 1\}} \backslash X} \{e\}
  %     \arrow[d]
  %     \\
  %     \Delta^{n-1} \backslash Y \times_{\Delta^{\{0, 1\}} \backslash Y} \{fe\}
  %     \arrow[r]
  %     & L_{n} \backslash Y \times_{\Delta^{\{0, 1\}} \backslash Y} \{fe\}
  %   \end{tikzcd}
  % \end{equation*}
\end{proof}

For any simplicial subset $A \subseteq \Delta^{n}$, denote the marking on $A$ where the only marked nondegenerate edge is $\Delta^{\{0, 1\}}$ by $A^{\mathcal{L}}$. If $A$ does not contain the edge $\Delta^{\{0, 1\}}$ then this agrees with the $\flat$-marking. For any simplicial set $A$, define a marked simplicial set $(\Delta^{1} \star A, \mathcal{L'})$ where the only nondegenerate simplex belonging to $\mathcal{L'}$ is $\Delta^{1}$.

\begin{lemma}
  \label{lemma:starred_smash_with_mono}
  Let $A \hookrightarrow B$ be a monomorphism of simplicial sets, and suppose that $B$ is $n$-skeletal (and therefore that $A$ is $n$-skeletal). Then the map
  \begin{equation*}
    \begin{tikzcd}
      (\Delta^{\{0\}} \star B)^{\flat} \coprod_{(\Delta^{\{0\}} \star A)^{\flat}} (\Delta^{1} \star A)^{\mathcal{L}'} \hookrightarrow (\Delta^{1} \star B)^{\mathcal{L}'}
    \end{tikzcd}
  \end{equation*}
  is in the saturated hull of the morphisms
  \begin{equation*}
    (\Lambda^{k}_{0})^{\mathcal{L}} \hookrightarrow (\Delta^{k})^{\mathcal{L}},\qquad 2 \leq k \leq n+2.
  \end{equation*}
\end{lemma}
\begin{proof}
  It suffices to show this for $A \hookrightarrow B = \partial \Delta^{m} \hookrightarrow \Delta^{m}$ for $0 \leq m \leq n$. In this case the necessary map is of the form
  \begin{equation*}
    (\Lambda^{m+2}_{0})^{\mathcal{L}} \hookrightarrow (\Delta^{m+2})^{\mathcal{L}}.
  \end{equation*}
\end{proof}

We will say a collection of morphisms $\mathcal{A} \subset \mathrm{Mor}(\SSet^{+})$ has the \emph{right cancellation property} if for all $u$, $v \in \mathrm{Mor}(\SSet^{+})$,
\begin{equation*}
  u \in \mathcal{A},\quad vu \in \mathcal{A} \quad \implies \quad v \in A.
\end{equation*}

\begin{lemma}
  \label{lemma:saturated_hull_of_left_spine_inclusions}
  Let $\mathcal{A}$ be a saturated set of morphisms of $\SSet^{+}$ all of whose underlying morphisms are monomorphisms, and which has the right cancellation property. Further suppose that $\mathcal{A}$ contains the following classes of morphisms.
  \begin{enumerate}
    \item Maps $(A)^{\flat} \hookrightarrow (B)^{\flat}$, where $A \to B$ is inner anodyne.

    \item Left spine inclusions $(L_{n})^{\mathcal{L}} \hookrightarrow (\Delta^{n})^{\mathcal{L}}$, $n \geq 2$.
  \end{enumerate}

  Then $\mathcal{A}$ contains left horn inclusions $(\Lambda^{n}_{0})^{\mathcal{L}} \hookrightarrow (\Delta^{n})^{\mathcal{L}}$, $n \geq 2$.
\end{lemma}
\begin{proof}
  We have an isomorphism $(L_{2})^{\mathcal{L}} \cong (\Lambda^{2}_{1})^{\mathcal{L}}$, which belongs to $\mathcal{A}$ because saturated sets contain all isomorphisms.

  We proceed by induction. Suppose we have shown the result for $n - 1$ i.e.\ that all horn inclusions $(\Lambda^{k}_{0})^{\mathcal{L}} \hookrightarrow (\Delta^{k})^{\mathcal{L}}$ belong to $\mathcal{A}$ for $2 \leq k \leq n-1$.  From now on on we will suppress the marking $(-)^{\mathcal{L}}$. All simplicial subsets of $\Delta^{n}$ below will have $\Delta^{\{0, 1\}}$ marked if they contain it.

  Consider the factorization
  \begin{equation*}
    \begin{tikzcd}
      L_{n}
      \arrow[r, "u_{n}"]
      \arrow[rr, bend right, swap, "v_{n} \circ u_{n}"]
      & \Lambda^{n}_{0}
      \arrow[r, "v_{n}"]
      & \Delta^{n}
    \end{tikzcd}.
  \end{equation*}
  The morphism $v_{n} \circ u_{n}$ belongs to $\mathcal{A}$ by assumption, so in order to show that $v_{n}$ belongs to $\mathcal{A}$, it suffices by right cancellation to show that $u_{n}$ belongs to $\mathcal{A}$. Consider the factorization
  \begin{equation*}
    \begin{tikzcd}
      L_{n}
      \arrow[r, "w'_{n}"]
      & L_{n} \cup d_{1} \Delta^{n}
      \arrow[r, "w_{n}"]
      & \Lambda^{n}_{0}.
    \end{tikzcd}
  \end{equation*}
  The map $w'_{n}$ is a pushout along a spine inclusion, and hence is inner anodyne. Hence, we need only show that $w_{n}$ belongs to $\mathcal{A}$. Let
  \begin{equation*}
    Q = d_{2} \Delta^{n} \cup \cdots \cup d_{n} \Delta^{n},
  \end{equation*}
  and consider the following pushout diagram.
  \begin{equation*}
    \begin{tikzcd}
      (L_{n} \cup d_{1}\Delta^{n}) \cap Q
      \arrow[r, hook]
      \arrow[d, hook]
      & Q
      \arrow[d, hook]
      \\
      L_{n} \cup d_{1} \Delta^{n}
      \arrow[r, hook]
      & L_{n} \cup d_{1}\Delta^{n} \cup Q
    \end{tikzcd}.
  \end{equation*}
  Since $L_{n} \cup d_{1} \Delta^{n} \cup Q \cong \Lambda^{n}_{0}$, the bottom map is $w_{n}$, so it suffices to show that the top map belongs to $\mathcal{A}$. But this is isomorphic to
  \begin{equation*}
    \begin{tikzcd}
      (\Delta^{\{0, 1\}} \star \emptyset) \coprod_{(\Delta^{\{0\}} \star \emptyset)} (\Delta^{\{0\}} \star \partial \Delta^{\{2, 3, \ldots, n\}}) \hookrightarrow \Delta^{\{0, 1\}} \star \partial \Delta^{\{2, 3, \ldots, n\}}.
    \end{tikzcd}
  \end{equation*}
  The simplicial set $\partial \Delta^{\{2, \ldots, n\}}$ is $(n-3)$-skeletal, so this map belongs to $\mathcal{A}$ by \hyperref[lemma:starred_smash_with_mono]{Lemma~\ref*{lemma:starred_smash_with_mono}}.
\end{proof}

\begin{definition}
  \label{def:cocartesian_fibration_between_complete_segal_spaces}
  Let $f\colon X \to Y$ be a Reedy fibration between complete Segal spaces. We will say that $f$ is a \defn{cocartesian fibration} if each morphism in $Y$ has an $f$-cocartesian lift in $X$.
\end{definition}

\begin{definition}
  \label{def:cocoartesian_marking_on_complete_segal_spaces}
  Let $f\colon X \to Y$ be a cocartesian fibration between complete Segal spaces. We define a marking on $X$ such that a morphism is marked if and only if it is $f$-cocartesian. We will denote the corresponding marked simplicial by set $X^{\natural}$. We can view the map $f$ as a map of marked bisimplicial sets $f\colon X^{\natural} \to Y^{\sharp}$.
\end{definition}

%\begin{lemma}
%  The marking $X^{\natural}$ has the property SOMETHING.
%\end{lemma}

\begin{note}
  Toby: In the rest of this subsection, we have to assume that the cocartesian marking respects path components. I'm convinced that this isn't necessary (i.e.\ that the cocartesian marking always respects path components), but as discussed I'm sending this to you before spending too much time trying to prove it.
\end{note}

\begin{proposition}
  \label{prop:segal_cocartesian_morphisms_are_quasicategory_cocartesian}
  Let $f\colon X \to Y$ be a cocartesian fibration of complete Segal spaces, and further assume that the natural marking on $Y$ respects path components. Let $e \in X_{10}$ be an $f$-cartesian morphism. Then $e$, viewed as a morphism in the quasicategory $X / \Delta^{0}$, is $f / \Delta^{0}$-cocartesian.
\end{proposition}
\begin{proof}
  Let $u^{n}_{0}\colon (\Lambda^{n}_{0} \hookrightarrow \Delta^{n})^{\mathcal{L}}$ denote the $\mathcal{L}$-marked inclusion. First, let $n \geq 2$, and consider the set
  \begin{equation*}
    S =
    \left\{
      \substack{
        u\colon A \to \text{ B morphism of} \\
        \text{marked simplicial sets} \\
        \text{such that $\mathring{u}$ is mono}
      }
      \ \bigg| \ 
      \langle u \backslash f \rangle \text{ weak homotopy equivalence}
    \right\}.
  \end{equation*}
  It is clear that this set has the right cancellation property. By \hyperref[prop:cartesian_marking_respects_path_components]{Proposition~\ref*{prop:cartesian_marking_respects_path_components}}, a map $u$ belonging to $S$ is automatically a Kan fibration, hence is a trivial Kan fibration. Thus, we can equivalently say that $u \in S$ if and only if $u$ has the left-lifting property with respect to all maps of the form $\langle X / v \rangle$, where $v$ is a cofibration of simplicial sets. Thus, $S$ is saturated.

  The set $S$ contains all flat-marked inner anodyne morphisms because $f$ is a Reedy fibration. \hyperref[prop:only_lowest_lifting_condition_is_necessary]{Proposition~\ref*{prop:only_lowest_lifting_condition_is_necessary}} implies that $S$ contains all left spine inclusions $(L_{n})^{\mathcal{L}} \hookrightarrow (\Delta^{n})^{\mathcal{L}}$, $n \geq 2$. Thus, by \hyperref[lemma:saturated_hull_of_left_spine_inclusions]{Lemma~\ref*{lemma:saturated_hull_of_left_spine_inclusions}}, we are done.
\end{proof}

\begin{corollary}
  Let $f\colon X \to Y$ be a cocartesian fibration of complete Segal spaces such that the cocartesian marking on $x$ respects path components. Then the map
  \begin{equation*}
    f/\Delta^{0}\colon X/\Delta^{0} \to Y/\Delta^{0}
  \end{equation*}
  is a cocartesian fibration of quasicategories.
\end{corollary}
\begin{proof}
  By \cite{qcats_vs_segal_spaces}, the map $f/\Delta^{0}$ is an isofibration between quasicategories, and hence is certainly an inner fibration. By assumption, every morphism in $Y$ has a $f$-cartesian lift. By\hyperref[prop:segal_cocartesian_morphisms_are_quasicategory_cocartesian]{Proposition~\ref*{prop:segal_cocartesian_morphisms_are_quasicategory_cocartesian}}, these lifts are also $f / \Delta^{0}$-cocartesian.
\end{proof}

\subsection{Further results}
\label{ssc:further_results}

\begin{note}
  Toby: The remainder of this section consists of half-typed stuff I have at best sketched proofs of. I think that I am quite close to a proof of \hyperref[thm:divide_by_marked_anodyne]{Theorem~\ref*{thm:divide_by_marked_anodyne}}.
\end{note}

\begin{lemma}
  Let $f\colon X \to Y$ be a Reedy fibration between complete Segal spaces, and let $e \in X_{1}$ be a homotopy equivalence. Then $e$ is $f$-cocartesian. In particular, all identity morphisms are $f$-cocartesian.
\end{lemma}

\begin{lemma}
  \label{lemma:cocartesian_closed_under_composition}
  Let $f\colon X \to Y$ be a Reedy fibration between complete Segal spaces, and let $\sigma \in X_{2}$ be a 2-simplex as follows.
  \begin{equation*}
    \begin{tikzcd}[column sep=small]
      & y
      \arrow[dr, "g"]
      \\
      x
      \arrow[ur, "f"]
      \arrow[rr, swap, "h"]
      && z
    \end{tikzcd}
  \end{equation*}
  Then if $f$ and $g$ are $f$-cocartesian, so is $h$.
\end{lemma}

\begin{theorem}
  \label{thm:divide_by_marked_anodyne}
  Let $f\colon X \to Y$ be a cocartesian fibration of complete Segal spaces, and denote also by $f$ the morphism $f\colon X^{\natural} \to Y^{\sharp}$ as in \hyperref[def:cocoartesian_marking_on_complete_segal_spaces]{Definition~\ref*{def:cocoartesian_marking_on_complete_segal_spaces}}. Then for any marked anodyne morphism $u$, the map $\langle u \backslash f \rangle$ is a trivial fibration.
\end{theorem}
\begin{proof}
  We check each class of morphisms in \cite{highertopostheory} separately. These are as follows.
  \begin{enumerate}
    \item

    \item

    \item The map
      \begin{equation*}
        (\Lambda^{2}_{1})^{\sharp} \amalg_{(\Lambda^{2}_{1})^{\flat}} (\Delta^{2})^{\flat} \to (\Delta^{2})^{\sharp}.
      \end{equation*}
  \end{enumerate}
  Los geht's.
  \begin{enumerate}
    \item For any morphism $u^{n}_{k}\colon (\Lambda^{n}_{k})^{\flat} \hookrightarrow (\Delta^{n})^{\flat}$, where $0 < k < n$, the map $\langle u \backslash f \rangle$ is isomorphic to the map $\langle \mathring{u} \backslash \mathring{f} \rangle$, which is a trivial fibration since $\mathring{f}$ is a Reedy fibration.

    \item 

    \item We need to show equivalently that for any anodyne map $A \to A'$ we can find a dashed lift as below.
      \begin{equation*}
        \begin{tikzcd}
          (\Lambda^{2}_{1})^{\sharp} \amalg_{(\Lambda^{2}_{1})^{\flat}} (\Delta^{2})^{\flat}
          \arrow[r]
          \arrow[d]
          & X / A'
          \arrow[d]
          \\
          (\Delta^{2})^{\sharp}
          \arrow[r]
          \arrow[ur, dashed]
          & X / A \times_{Y / A} Y / A'
        \end{tikzcd}
      \end{equation*}
      Since a lift of the underlying diagram of
  \end{enumerate}
\end{proof}

\begin{corollary}
  Let $f\colon X \to Y$ be a cocartesian fibration between complete Segal spaces. Then the corresponding map $f / \Delta^{0}$ between first rows is a cocartesian fibration of quasicategories.
\end{corollary}
\begin{proof}
  Since $\langle u \backslash f \rangle$ is a trivial fibration, for any marked anodyne map $u\colon A \to A'$ we can solve the lifting problem
  \begin{equation*}
    \begin{tikzcd}
      \emptyset
      \arrow[r]
      \arrow[d]
      & A' \backslash X^{\natural}
      \arrow[d]
      \\
      \Delta^{0}
      \arrow[r]
      \arrow[ur, dashed]
      & A \backslash X^{\natural} \times_{A' \backslash Y^{\sharp}} A' \backslash Y^{\sharp}
    \end{tikzcd}.
  \end{equation*}

  This is equivalent to the lifting problem
  \begin{equation*}
    \begin{tikzcd}
      A
      \arrow[r]
      \arrow[d]
      & X^{\natural} / \Delta^{0}
      \arrow[d]
      \\
      A'
      \arrow[r]
      \arrow[ur, dashed]
      & Y^{\sharp} / \Delta^{0}
    \end{tikzcd}.
  \end{equation*}
  Thus, the map $f / \Delta^{0}$ has the right lifting property with respect to all marked anodyne morphisms and every morphism in $Y / \Delta^{0}$ is marked, which implies that the map $f / \Delta^{0}$ is a cocartesian fibration.
\end{proof}

\section{Complete Segal spaces of spans}
\label{sec:complete_segal_spaces_of_spans}

\begin{note}
  Toby: Barwick's theorem is more general in the sense that he allows one to choose classes of maps that the forward- and backward-facing maps in the spans are allowed to belong to. I haven't though much about how much more difficult it would be to allow for this. This seems pretty important for a wide variety of reasons; for example, it would allow us to treat cases like $\category{C}^{\otimes} \to \Finp$.
\end{note}

The main goal of this section is to prove the following theorem.

\begin{theorem}
  \label{thm:span_of_bicartesian_fibration_is_bicartesian_fibration}
  Let $\category{C}$ and $\category{D}$ be quasicategories admitting all pullbacks, and let $p\colon \category{C} \to \category{D}$ be a bicartesian fibration which preserves pullbacks. Further suppose that $p$ has the following property:

  \begin{quote}
    For any square
    \begin{equation*}
      \sigma =
      \begin{tikzcd}
        x
        \arrow[r, "f"]
        \arrow[d]
        & y
        \arrow[d]
        \\
        x'
        \arrow[r, "f'", "\bullet" marking]
        & y'
      \end{tikzcd}
    \end{equation*}
    in $\category{C}$ such that the morphism $f'$ is $p$-cocartesian and $p(\sigma)$ is pullback in $\category{D}$, the following are equivalent.
    \begin{itemize}
      \item The morphism $f$ is $p$-cocartesian.

      \item The square $\sigma$ is pullback.
    \end{itemize}
  \end{quote}

  Then the functor $\pi\colon \Span(\category{C}) \to \Span(\category{D})$ is a cocartesian fibration of Segal spaces, whose cocartesian morphisms are spans of the form
  \begin{equation*}
    \begin{tikzcd}
      & y
      \arrow[dl, "\circ" marking]
      \arrow[dr, "\bullet" marking]
      \\
      x
      && x'
    \end{tikzcd}.
  \end{equation*}
\end{theorem}

\begin{note}
  Since the definition of $\Span(\category{C})$ is self-dual, the functor $\Span(\category{C}) \to \Span(\category{D})$ is also a cartesian fibration with cartesian morphisms of the form
  \begin{equation*}
    \begin{tikzcd}
      & y
      \arrow[dl, "\bullet" marking]
      \arrow[dr, "\circ" marking]
      \\
      x
      && x'
    \end{tikzcd}.
  \end{equation*}
\end{note}

We prove \hyperref[thm:span_of_bicartesian_fibration_is_bicartesian_fibration]{Theorem~\ref*{thm:span_of_bicartesian_fibration_is_bicartesian_fibration}} in several steps. Since we will be working with bicartesian fibrations, it will be helpful to adapt some of the tools of marked simplicial sets to our purposes.

\subsection{Bimarked simplicial sets}
\label{ssc:bimarked_simplicial_sets}

Our proof of \hyperref[thm:span_of_bicartesian_fibration_is_bicartesian_fibration]{Theorem~\ref*{thm:span_of_bicartesian_fibration_is_bicartesian_fibration}} will involve working with with bicartesian fibrations. For this reason, it will be helpful to have results about simplicial sets with two markings, one of which controls the cocartesian structure and one of which controls the cartesian structure. This section consists mainly of verifications that some key results about marked simplicial sets which can be found in \cite[Sec.\ 3.1]{highertopostheory} hold in the bimarked case. The only results we will make use of are \hyperref[proposition:bimarked_anodyne_homotopy_pullback]{Proposition~\ref*{proposition:bimarked_anodyne_homotopy_pullback}}, \hyperref[eg:bimarking_on_asd_delta1]{Example~\ref*{eg:bimarking_on_asd_delta1}}, and \hyperref[eg:bimarking_on_asd_delta2]{Example~\ref*{eg:bimarking_on_asd_delta2}}.

\begin{definition}
  A \defn{bimarked simplicial set} is a triple $(X, \mathcal{E}, \mathcal{E}')$, where $X$ is a simplicial set and $\mathcal{E}$ and $\mathcal{E}'$ are markings. We will often shorten this to $X^{(\mathcal{E}, \mathcal{E}')}$. A morphism of bimarked simplicial sets is a morphism of the underlying simplicial sets which preserves each class of markings separately. We will denote the category of bimarked simplicial sets by $\SSet^{++}$.
\end{definition}

\begin{example}
  For any simplicial set $X$ we will denote
  \begin{itemize}
    \item The bimarked simplicial set where $\mathcal{E}$ and $\mathcal{E}'$ contain only the degenerate edges by $X^{( \flat, \flat )}$,

    \item The bimarked simplicial set where $\mathcal{E}$ contains only the degenerate edges and $\mathcal{E}'$ contains every edge by $X^{( \flat, \sharp )}$,

    \item The bimarked simplicial set where $\mathcal{E}$ contains every edge and $\mathcal{E}'$ contains only the degenerate edges by $X^{( \sharp, \flat )}$, and

    \item The bimarked simplicial set where $\mathcal{E}$ and $\mathcal{E}'$ contain every edge by $X^{( \sharp, \sharp )}$.
  \end{itemize}
\end{example}

\begin{example}
  \label{eg:bicartesian_marking}
  Let $p\colon \category{C} \to \category{D}$ be a bicartesian fibration. Denote by $\category{C}^{\natural}$ the bimarked simplicial set where
  \begin{itemize}
    \item The set $\mathcal{E}$ is the set of all $p$-cocartesian morphisms, and

    \item The set $\mathcal{E}'$ is the set of all $p$-cartesian morphisms.
  \end{itemize}

  In this way every bicartesian fibration gives a morphism of bimarked simplicial sets.
\end{example}

The category $\SSet^{++}$ is closely connected to the category $\SSet^{+}$ and the category $\SSet$. We have the following obvious results.
\begin{itemize}
  \item There is a forgetful functor $u\colon \SSet^{++} \to \SSet$ which forgets both markings. This has left adjoint $\iota\colon X \mapsto (X, \flat, \flat)$. The functor $\iota$ is a full subcategory inclusion.

  \item There is a forgetful functor $u_{1}\colon \SSet^{++} \to \SSet^{+}$, which forgets the second marking, sending $(X, \mathcal{E}, \mathcal{E}') \mapsto (X, \mathcal{E})$. This has a left adjoint $\iota_{1}$ given by the functor which sends $(X, \mathcal{E}) \mapsto (X, \mathcal{E}, \flat)$. The functor $\iota_{1}$ is a full subcategory inclusion; there is a bijection between maps between marked simplicial sets $(X, \mathcal{E}) \to (Y, \mathcal{E}')$ and maps $(X, \mathcal{E}, \flat) \to (Y, \mathcal{E}', \flat)$. The same is true of the functor $u_{2}$ which forgets the first marking and its left adjoint $\iota_{2}$.
\end{itemize}

Just as in the marked case, we will a set of bimarked anodyne morphisms, the morphisms with the left lifting property with respect to bicartesian fibrations.

\begin{definition}
  The class of \defn{bimarked anodyne morphisms} is the saturated hull of the union of the following classes of morphisms.
  \begin{enumerate}
    \item[(1)] For each $0  < i < n$, the inner horn inclusions
      \begin{equation*}
        (\Lambda^{n}_{i})^{(\flat, \flat)} \to (\Delta^{n})^{(\flat, \flat)}.
      \end{equation*}

    \item[(2)] For every $n > 0$, the inclusion
      \begin{equation*}
        (\Lambda^{n}_{0})^{(\mathcal{L}, \flat)} \hookrightarrow (\Delta^{n})^{(\mathcal{L}, \flat)},
      \end{equation*}
      where $\mathcal{L}$ denotes the set of all degenerate edges of $\Delta^{n}$ together with the edge $\Delta^{\{0, 1\}}$.

    \item[(2')] For every $n > 0$, the inclusion
      \begin{equation*}
        (\Lambda^{n}_{n})^{(\flat, \mathcal{R})} \hookrightarrow (\Delta^{n})^{(\flat, \mathcal{R})},
      \end{equation*}
      where $\mathcal{R}$ denotes the set of all degenerate edges of $\Delta^{n}$ together with the edge $\Delta^{\{n-1, n\}}$.

    \item[(3)] The inclusion
      \begin{equation*}
        (\Lambda^{2}_{1})^{(\sharp, \flat)} \coprod_{(\Lambda^{2}_{1})^{(\flat, \flat)}} (\Delta^{2})^{(\flat, \flat)} \to (\Delta^{2})^{(\sharp, \flat)}.
      \end{equation*}

    \item[(3')] The inclusion
      \begin{equation*}
        (\Lambda^{2}_{1})^{(\flat, \sharp)} \coprod_{(\Lambda^{2}_{1})^{(\flat, \flat)}} (\Delta^{2})^{(\flat, \flat)} \to (\Delta^{2})^{(\flat, \sharp)}.
      \end{equation*}

    \item[(4)] For every Kan complex $K$, the map
      \begin{equation*}
        K^{(\flat, \flat)} \to K^{(\sharp, \flat)}.
      \end{equation*}

    \item[(4')] For every Kan complex $K$, the map
      \begin{equation*}
        K^{(\flat, \flat)} \to K^{(\flat, \sharp)}.
      \end{equation*}
  \end{enumerate}
\end{definition}

\begin{example}
  \label{eg:bimarking_on_asd_delta1}
  Define a bimarked structure $(\asd(\Delta^{1}), \mathcal{E}, \mathcal{E}') = \asd(\Delta^{1})^{\heartsuit}$ on $\asd(\Delta^{1})$, where the morphism $01 \to 11$ is $\mathcal{E}$-marked, and the morphism $01 \to 00$ is $\mathcal{E}'$-marked. Denoting $\mathcal{E}$-marked morphisms with a $\bullet$ and $\mathcal{E}'$-marked morphisms with a $\circ$, we can draw this as follows.
  \begin{equation*}
    \begin{tikzcd}
      && 11
      \\
      & 01
      \arrow[ur, "\bullet" marking]
      \arrow[dl, "\circ" marking]
      \\
      00
    \end{tikzcd}
  \end{equation*}

  The inclusion $\{00\} = \asd(\Delta^{\{0\}}) \hookrightarrow \asd(\Delta^{1})^{\heartsuit}$ is bimarked anodyne: we can factor it
  \begin{equation*}
    \{00\} \hookrightarrow (\Delta^{1})^{(\flat, \sharp)} \hookrightarrow \asd(\Delta^{1})^{\heartsuit},
  \end{equation*}
  where the first inclusion is of the form (2') and the second is a pushout of a morphism of the form (2). We can draw this process as follows.
  \begin{equation*}
    \begin{tikzcd}
      \
      \\
      \
      \\
      00
    \end{tikzcd}
    \qquad\hookrightarrow\qquad
    \begin{tikzcd}
      & \
      \\
      & 01
      \arrow[dl, "\circ" marking]
      \\
      00
    \end{tikzcd}
    \qquad\hookrightarrow\qquad
    \begin{tikzcd}
      && 11
      \\
      & 01
      \arrow[ur, "\bullet" marking]
      \arrow[dl, "\circ" marking]
      \\
      00
    \end{tikzcd}
  \end{equation*}
\end{example}

\begin{example}
  \label{eg:bimarking_on_asd_delta2}
  Define a bimarked structure $\asd(\Delta^{2})^{\heartsuit}$ on $\asd(\Delta^{2})$, following the notation of \hyperref[eg:bimarking_on_asd_delta1]{Example~\ref*{eg:bimarking_on_asd_delta1}}, as follows.
  \begin{equation*}
    \begin{tikzcd}
      && 11
      \\
      & 01
      \arrow[ur, "\bullet" marking]
      \arrow[dl, "\circ" marking]
      && 12
      \arrow[ul]
      \arrow[dr]
      \\
      00
      && 02
      \arrow[ll]
      \arrow[rr]
      \arrow[uu]
      \arrow[ur, "\bullet" marking]
      \arrow[ul]
      && 22
    \end{tikzcd}
  \end{equation*}
  Note that the bimarking of \hyperref[eg:bimarking_on_asd_delta1]{Example~\ref*{eg:bimarking_on_asd_delta1}} is the restriction of $\asd(\Delta^{2})^{\heartsuit}$ to $\asd(\Delta^{\{0, 1\}})$. Denote the restriction of the bimarking $\asd(\Delta^{2})^{\heartsuit}$ to $\asd(\Delta^{\{0, 2\}})$ by $\asd(\Delta^{\{0, 2\}})^{\heartsuit}$; this agrees with the $(\flat,\flat)$-marking.

  The inclusion $\asd(\Delta^{\{0, 2\}})^{\heartsuit} \hookrightarrow \asd(\Delta^{2})^{\heartsuit}$ is bimarked anodyne. To see this, note that... factorization...
\end{example}

\begin{proposition}
  \label{prop:rlp_bimarked_anodyne}
  A map $p\colon (X, \mathcal{E}_{X}, \mathcal{E}_{X}') \to (S, \mathcal{E}_{S}, \mathcal{E}_{S}')$ of bimarked simplicial sets has the right lifting property with respect to bimarked anodyne morphisms if and only if the following conditions are satisifed.
  \begin{enumerate}
    \item[(A)] The map $p$ is an inner fibration of simplicial sets.

    \item[(B)] An edge $e$ of $X$ is $\mathcal{E}_{X}$-marked if and only if $p(e)$ is $\mathcal{E}_{S}$-marked and $e$ is $p$-cocartesian.

    \item[(B')] An edge $e$ of $X$ is $\mathcal{E}'_{X}$-marked if and only if $p(e)$ is $\mathcal{E}'_{S}$-marked and $e$ is $p$-cartesian.

    \item[(C)] For every object $y$ of $X$ and every $\mathcal{E}_{S}$-marked edge $\bar{e}\colon \bar{x} \to p(y)$ in $S$, there exists a $\mathcal{E}_{X}$ marked edge $e\colon x \to y$ of $X$ with $p(e) = \bar{e}$.

    \item[(C')] For every object $y$ of $X$ and every $\mathcal{E}'_{S}$-marked edge $\bar{e}\colon \bar{x} \to p(y)$ in $S$, there exists a $\mathcal{E}'_{X}$ marked edge $e\colon x \to y$ of $X$ with $p(e) = \bar{e}$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  By \cite[Prop.\ 3.1.1.6]{highertopostheory}, (A), (B) and (C) are equivalent to (1), (2), and (3). By its dual, (A), (B') and (C') are equivalent to (1), (2'), and (3')
\end{proof}

We would like to define cofibrations of bimarked simplicial sets to be maps of bimarked simplicial sets whose underlying map of simplicial sets is a monomorphism, and then show that the class of bimarked anodyne maps is stable under smash products with arbitrary cofibrations. Unfortunately, this turns out not to be quite true; the candidate class of cofibrations described above is generated by the following classes of maps.
\begin{itemize}
  \item[(I)] Boundary fillings $(\partial \Delta^{n})^{(\flat, \flat)} \to (\Delta^{n})^{(\flat, \flat)}$.

  \item[(II)] Markings $(\Delta^{1})^{(\flat, \flat)} \to (\Delta^{1})^{(\sharp, \flat)}$.

  \item[(III)] Markings $(\Delta^{1})^{(\flat, \flat)} \to (\Delta^{1})^{(\flat, \sharp)}$.
\end{itemize}
There is nothing that tells us, for example, that the smash product of a bimarked anodyne map of type $(2)$ with a cofibration of type (III) should be bimarked anodyne. Denoting arrows with the first marking using a $\bullet$ and the second using a $\circ$, this amounts, in the case $n = 0$, to the statement that the map
\begin{equation*}
  \begin{tikzcd}
    \cdot
    \arrow[r]
    \arrow[d, "\bullet" marking]
    \arrow[dr]
    & \cdot
    \arrow[d, "\bullet" marking]
    \\
    \cdot
    \arrow[r, "\circ" marking]
    & \cdot
  \end{tikzcd}
  \quad \longrightarrow \quad
  \begin{tikzcd}
    \cdot
    \arrow[r, "\circ" marking]
    \arrow[d, "\bullet" marking]
    \arrow[dr]
    & \cdot
    \arrow[d, "\bullet" marking]
    \\
    \cdot
    \arrow[r, "\circ" marking]
    & \cdot
  \end{tikzcd}
\end{equation*}
should be bimarked anodyne, which it isn't. However, we have the following weaker statement.

\begin{lemma}
  \label{lemma:smash_product_of_bimarked_anodyne_and_monic_is_bimarked_anodyne}
  The class of bimarked anodyne maps in $\SSet^{++}$ is stable under smash products with flat monomorphisms, i.e.\ morphisms $A^{(\flat, \flat)} \to B^{(\flat, \flat)}$ such that the underlying morphism of simplicial sets $A \to B$ is a monomorphism. That is, if $f\colon X \to Y$ is bimarked anodyne and $A \to B$ is a monomorphism of simplicial sets, then
  \begin{equation*}
    (X \times B^{(\flat, \flat)}) \coprod_{X \times A^{(\flat, \flat)}} (Y \times A^{(\flat, \flat)}) \to Y \times B^{(\flat, \flat)}
  \end{equation*}
  is bimarked anodyne.
\end{lemma}
\begin{proof}
  It suffices to show that for any flat boundary inclusion $(\partial \Delta^{n})^{(\flat, \flat)} \to (\Delta^{n})^{(\flat, \flat)}$ and any generating bimarked anodyne morphism $X \to Y$, the map
  \begin{equation*}
    (X \times (\Delta^{n})^{(\flat, \flat)}) \coprod_{X \times (\partial \Delta^{n})^{(\flat, \flat)}} (Y \times (\partial\Delta^{n})^{(\flat, \flat)}) \to Y \times (\Delta^{n})^{(\flat, \flat)}
  \end{equation*}
  is bimarked anodyne. If $X \to Y$ belongs to one of the classes (1), (2'), (3'), or (4'), then this is true by the arguments of \cite[Prop.\ 3.1.2.3]{highertopostheory}. If $X \to Y$ belongs to one of the classes (1), (2), (3), or (4), then it is true by the dual arguments.
\end{proof}

\begin{definition}
  For any bimarked simplicial sets $X$, $Y$, define a simplicial set $\Map^{(\flat, \flat)}(X, Y)$ by the following universal property: for any simplicial set $Z$, there is a bijection
  \begin{equation*}
    \Hom_{\SSet}(Z, \Map^{(\flat, \flat)}(X, Y)) \cong \Hom_{\SSet^{++}}(Z^{(\flat, \flat)} \times X, Y).
  \end{equation*}
\end{definition}

\begin{proposition}
  \label{proposition:bimarked_anodyne_homotopy_pullback}
  Let $p\colon \category{C} \to \category{D}$ be a bicartesian fibration of quasicategories, and denote by $\category{C}^{\natural} \to \category{D}^{(\sharp, \sharp)}$ the associated map of bimarked simplicial sets as in \hyperref[eg:bicartesian_marking]{Example~\ref*{eg:bicartesian_marking}}. Let $X \to Y$ be any bimarked anodyne map of simplicial sets. Then the square
  \begin{equation*}
    \begin{tikzcd}
      \Fun^{(\flat, \flat)}(Y, \category{C}\nat)^{\simeq}
      \arrow[r]
      \arrow[d]
      & \Fun^{(\flat, \flat)}(X, \category{C}\nat)^{\simeq}
      \arrow[d]
      \\
      \Fun^{(\flat, \flat)}(Y, \category{D}^{(\sharp, \sharp)})^{\simeq}
      \arrow[r]
      & \Fun^{(\flat, \flat)}(X, \category{D}^{(\sharp, \sharp)})^{\simeq}
    \end{tikzcd}
  \end{equation*}
  is a homotopy pullback in the Kan model structure.
\end{proposition}
\begin{proof}
  First, we show that the right-hand map is a Kan fibration. In fact, the underlying map
  \begin{equation*}
    \Fun^{(\flat, \flat)}(X, \category{C}^{\natural}) \to \Fun^{(\flat, \flat)}(X, \category{D}^{(\sharp, \sharp)})
  \end{equation*}
  is a trivial Kan fibration, since by \hyperref[lemma:smash_product_of_bimarked_anodyne_and_monic_is_bimarked_anodyne]{Lemma~\ref*{lemma:smash_product_of_bimarked_anodyne_and_monic_is_bimarked_anodyne}} together with \hyperref[prop:rlp_bimarked_anodyne]{Proposition~\ref*{prop:rlp_bimarked_anodyne}} we can solve the necessary lifting problems. This, together with the fact that each of the objects is a Kan complex, implies that in order to show that the above square is homotopy pullback it suffices to check that the map
  \begin{equation*}
    \Fun^{(\flat, \flat)}(Y, \category{C}\nat)^{\simeq} \to \Fun^{(\flat, \flat)}(X, \category{C}\nat)^{\simeq} \times_{\Fun^{(\flat, \flat)}(Y, \category{D}^{(\sharp, \sharp)})^{\simeq}} \Fun^{(\flat, \flat)}(X, \category{D}^{(\sharp, \sharp)})^{\simeq}
  \end{equation*}
  is a trivial Kan fibration. Since the functor $(-)^{\simeq}$ is a right adjoint it preserves limits, so it again suffices to show that the underlying map
  \begin{equation*}
    \Fun^{(\flat, \flat)}(Y, \category{C}\nat) \to \Fun^{(\flat, \flat)}(X, \category{C}\nat) \times_{\Fun^{(\flat, \flat)}(Y, \category{D}^{(\sharp, \sharp)})} \Fun^{(\flat, \flat)}(X, \category{D}^{(\sharp, \sharp)})
  \end{equation*}
  is a trivial fibration, which follows from \hyperref[lemma:smash_product_of_bimarked_anodyne_and_monic_is_bimarked_anodyne]{Lemma~\ref*{lemma:smash_product_of_bimarked_anodyne_and_monic_is_bimarked_anodyne}}.
\end{proof}

\subsection{Cartesian morphisms}
\label{ssc:cartesian_morphisms}

In this section, we show that we really have identified the cocartesian morphisms correctly. We will first show that morphisms of the form
\begin{equation}
  \label{eq:form_of_p_cocartesian_morphisms}
  \begin{tikzcd}
    & y
    \arrow[dl, "\circ" marking]
    \arrow[dr, "\bullet" marking]
    \\
    x
    && x'
  \end{tikzcd}.
\end{equation}
are $p$-cocartesian.

\begin{proposition}
  \label{prop:form_of_cocartesian_morphisms_in_spans}
  Let $\pi\colon \category{C} \to \category{D}$ be a bicartesian fibration of quasicategories which preserves pullbacks and satisfies the condition of \hyperref[thm:span_of_bicartesian_fibration_is_bicartesian_fibration]{Theorem~\ref*{thm:span_of_bicartesian_fibration_is_bicartesian_fibration}}, and let
  \begin{equation*}
    p\colon \Span(\category{C}) \to \Span(\category{D})
  \end{equation*}
  be the corresponding map between complete Segal spaces of spans. If a morphism in $\Span(\category{C})$ is of the form
  \begin{equation*}
    \begin{tikzcd}
      & y
      \arrow[dl, "\circ" marking]
      \arrow[dr, "\bullet" marking]
      \\
      x
      && x'
    \end{tikzcd},
  \end{equation*}
  where the morphism marked with a $\circ$ is $\pi$-cartesian and the morphism marked with a $\bullet$ is $\pi$-cocartesian, then it is $p$-cocartesian.
\end{proposition}
\begin{proof}
  In order to show that a morphism $e\colon x \leftarrow y \rightarrow x'$ of the form given in \hyperref[prop:form_of_cocartesian_morphisms_in_spans]{Proposition~\ref*{prop:form_of_cocartesian_morphisms_in_spans}} are cocartesian, we have to show that 
  %the square
  %\begin{equation*}
  %  \begin{tikzcd}
  %    \Span(\category{C})_{2} \times_{\Span(\category{C})_{\{0, 1\}}} \{e\}
  %    \arrow[r]
  %    \arrow[d]
  %    & \Span(\category{C})_{\{0, 2\}} \times_{\Span(\category{C})_{\{0\}}} \{x\}
  %    \arrow[d]
  %    \\
  %    \Span(\category{D})_{2} \times_{\Span(\category{D})_{\{0, 1\}}} \{\pi e\}
  %    \arrow[r]
  %    & \Span(\category{D})_{\{0, 2\}} \times_{\Span(\category{D})_{\{0\}}} \{\pi x\}
  %  \end{tikzcd}
  %\end{equation*}
  %is homotopy pullback. Expanding, we have to show that 
  the square
  \begin{equation*}
    \begin{tikzcd}
      \Fun^{\Cart}(\asd(\Delta^{2}), \category{C})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0, 1\}}), \category{C})^{\simeq}} \{e\}
      \arrow[r]
      \arrow[d]
      & \Fun(\asd(\Lambda^{2}_{0}), \category{C})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0, 1\}}), \category{C})^{\simeq}} \{e\}
      \arrow[d]
      \\
      \Fun^{\Cart}(\asd(\Delta^{2}), \category{D})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0, 1\}}), \category{D})^{\simeq}} \{\pi e\}
      \arrow[r]
      & \Fun(\asd(\Delta^{\{0, 2\}}), \category{D})^{\simeq} \times_{\Fun(\asd(\Lambda^{2}_{0}), \category{D})^{\simeq}} \{\pi e\}
    \end{tikzcd}
  \end{equation*}
  is homotopy pullback.

  Recall the bimarked structure $\asd(\Delta^{2})^{\heartsuit} = (\asd(\Delta^{2}), \mathcal{E}, \mathcal{E}')$ on $\asd(\Delta^{2})$ of \hyperref[eg:bimarking_on_asd_delta2]{Example~\ref*{eg:bimarking_on_asd_delta2}}, reproduced below, where the nondegenerate edges in $\mathcal{E}$ are distinguished with a $\bullet$, and the nondegenerate edges in $\mathcal{E}'$ are distinguished with a $\circ$.
  \begin{equation*}
    \begin{tikzcd}
      && 11
      \\
      & 01
      \arrow[ur, "\bullet" marking]
      \arrow[dl, "\circ" marking]
      && 12
      \arrow[ul]
      \arrow[dr]
      \\
      00
      && 02
      \arrow[ll]
      \arrow[rr]
      \arrow[uu]
      \arrow[ur, "\bullet" marking]
      \arrow[ul]
      && 22
    \end{tikzcd}
  \end{equation*}
  Denote the induced bimarked structures on $\asd(\Delta^{\{0, 1\}})$, $\asd(\Delta^{\{0, 2\}})$, and $\asd(\Delta^{\{0\}})$ also with a heart. Except in the case of $\asd(\Delta^{\{0, 1\}})^{\heartsuit}$, these agree with the $(\flat, \flat)$-bimarked structure.

  We now note that we can decompose the above square into two squares
  \begin{equation*}
    \begin{tikzcd}[column sep=tiny]
      \Fun^{\Cart}(\asd(\Delta^{2}), \category{C})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0, 1\}}), \category{C})^{\simeq}} \{e\}
      \arrow[r]
      \arrow[d]
      & \Fun^{(\flat, \flat)}(\asd(\Delta^{2})^{\heartsuit}, \category{C}^{\natural})^{\simeq} \times_{\Fun^{(\flat, \flat)}(\asd(\Delta^{\{0, 1\}})^{\heartsuit}, \category{C}^{\natural})^{\simeq}} \{e\}
      \arrow[d]
      \\
      \Fun^{\Cart}(\asd(\Delta^{2}), \category{D})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0, 1\}}), \category{D})^{\simeq}} \{\pi e\}
      \arrow[r]
      & \Fun^{(\flat, \flat)}(\asd(\Delta^{2})^{\heartsuit}, \category{D}^{(\sharp, \sharp)})^{\simeq} \times_{\Fun^{(\flat, \flat)}(\asd(\Delta^{\{0, 1\}})^{\heartsuit}, \category{D}^{(\sharp, \sharp)})^{\simeq}} \{\pi e\}
    \end{tikzcd}
  \end{equation*}
  and
  \begin{equation*}
    \begin{tikzcd}[column sep=tiny]
      \Fun^{(\flat, \flat)}(\asd(\Delta^{2})^{\heartsuit}, \category{C}^{\natural})^{\simeq} \times_{\Fun^{(\flat, \flat)}(\asd(\Delta^{\{0, 1\}})^{\heartsuit}, \category{C}^{\natural})^{\simeq}} \{e\}
      \arrow[r]
      \arrow[d]
      & \Fun(\asd(\Delta^{\{0, 2\}}), \category{C})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0\}}), \category{C})^{\simeq}} \{x\}
      \arrow[d]
      \\
      \Fun^{(\flat, \flat)}(\asd(\Delta^{2})^{\heartsuit}, \category{D}^{(\sharp, \sharp)})^{\simeq} \times_{\Fun^{(\flat, \flat)}(\asd(\Delta^{\{0, 1\}})^{\heartsuit}, \category{D}^{(\sharp, \sharp)})^{\simeq}} \{\pi e\}
      \arrow[r]
      & \Fun(\asd(\Delta^{\{0, 2\}}), \category{D})^{\simeq} \times_{\Fun(\asd(\Delta^{\{0\}}), \category{D})^{\simeq}} \{\pi x\}
    \end{tikzcd}.
  \end{equation*}
  The first square is a homotopy pullback because the bottom morphism is a full subcategory inclusion of connected components, and the fiber over a connected component corresponding to Cartesian functors $\asd(\Delta^{2}) \to \category{D}$ is consists precisely of Cartesian functors $\asd(\Delta^{2}) \to \category{C}$ by the condition of \hyperref[thm:span_of_bicartesian_fibration_is_bicartesian_fibration]{Theorem~\ref*{thm:span_of_bicartesian_fibration_is_bicartesian_fibration}}.

  Therefore, we need to show that the second square is homotopy pullback. For this it suffices to show separately that the squares
  \begin{equation*}
    \begin{tikzcd}
      \Fun^{(\flat, \flat)}(\asd(\Delta^{2})^{\heartsuit}, \category{C}^{\natural})^{\simeq}
      \arrow[r]
      \arrow[d]
      & \Fun(\asd(\Delta^{\{0, 2\}}), \category{C})^{\simeq}
      \arrow[d]
      \\
      \Fun^{(\flat, \flat)}(\asd(\Delta^{2})^{\heartsuit}, \category{D}^{(\sharp, \sharp)})^{\simeq}
      \arrow[r]
      & \Fun(\asd(\Delta^{\{0, 2\}}), \category{D})^{\simeq}
    \end{tikzcd}.
  \end{equation*}
  and
  \begin{equation*}
    \begin{tikzcd}
      \Fun^{(\flat, \flat)}(\asd(\Delta^{\{0, 1\}})^{\heartsuit}, \category{C}^{\natural})^{\simeq}
      \arrow[r]
      \arrow[d]
      & \Fun(\asd(\Delta^{\{0\}}), \category{C})^{\simeq}
      \arrow[d]
      \\
      \Fun^{(\flat, \flat)}(\asd(\Delta^{\{0, 1\}})^{\heartsuit}, \category{D}^{(\sharp, \sharp)})^{\simeq}
      \arrow[r]
      & \Fun(\asd(\Delta^{\{0\}}), \category{D})^{\simeq}
    \end{tikzcd}.
  \end{equation*}
  are homotopy pullback. But it is easy to see that these are of the form of the square in \hyperref[proposition:bimarked_anodyne_homotopy_pullback]{Proposition~\ref*{proposition:bimarked_anodyne_homotopy_pullback}}; the first has $X \to Y = \asd(\Delta^{\{0, 2\}})^{\heartsuit} \to \asd(\Delta^{2})^{\heartsuit}$, which we saw in \hyperref[eg:bimarking_on_asd_delta2]{Example~\ref*{eg:bimarking_on_asd_delta2}} was bimarked anodyne, and the second has $X \to Y = \asd(\Delta^{\{0\}})^{\heartsuit} \to \asd(\Delta^{\{0, 1\}})^{\heartsuit}$, which we saw in \hyperref[eg:bimarking_on_asd_delta1]{Example~\ref*{eg:bimarking_on_asd_delta1}} was bimarked anodyne. Both are therefore homotopy pullback.
\end{proof}

Thus we have shown that if a morphism has the form of \hyperref[eq:form_of_p_cocartesian_morphisms]{Equation~\ref*{eq:form_of_p_cocartesian_morphisms}}, it is $p$-cocartesian. It remains to show the reverse implication.

First note that since $\asd(\Delta^{0})^{\heartsuit} \to \asd(\Delta^{1})^{\heartsuit}$ is bimarked anodyne, every morphism has a lift of the form \hyperref[eq:form_of_p_cocartesian_morphisms]{Equation~\ref*{eq:form_of_p_cocartesian_morphisms}}, which we have just shown is $p$-cocartesian. Since any two $p$-cocartesian lifts are equivalent, any morphism which is a $p$-cocartesian lift is equivalent to such a morphism, and hence must be of that form.

\begin{appendix}
  \section{Background results}
  \label{sec:background}

  \subsection{Results from J+T}
  \label{ssc:results_from_j_t}

  \subsection{Results about equivalences}
  \label{ssc:results_about_equivalences}
\end{appendix}


\end{document}
